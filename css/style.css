/*******************************************************
 * å…±é€šè¨­å®š
 *******************************************************/
html, body {
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100%;
  font-family: sans-serif;
  background-color: #222;
  color: #fff;
}

/*******************************************************
 * ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢
 *******************************************************/
#loginScreen {
  position: absolute;
  z-index: 9999;
  top: 0; left: 0;
  width: 100%;
  height: 100%;
  background: black;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
}

#loginScreen input {
  color: #fff;            /* ç™½æ–‡å­— */
  background-color: #333; /* ã»ã©ã‚ˆãæš—ã„èƒŒæ™¯ */
  border: 1px solid #fff; /* æ ã‚’ç™½ã« */
  padding: 8px;
  margin: 8px;
}
#loginScreen button {
  font-size: 18px;
  padding: 8px 12px;
  margin: 10px;
  border-radius: 4px;
}

/* ãƒ­ãƒ¼ãƒ‰ç”»é¢ */
.loading-screen {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: black;
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 9999;
}

#loadingText {
  font-size: 3rem;
  color: white;
  text-shadow: 2px 2px 5px rgba(255, 255, 255, 0.7),
               -2px -2px 5px rgba(255, 0, 0, 0.5),
               2px -2px 5px rgba(0, 255, 0, 0.5),
               -2px 2px 5px rgba(0, 0, 255, 0.5);
  animation: loadingAnim 1.5s infinite alternate;
}

@keyframes loadingAnim {
  0% { opacity: 0.5; }
  100% { opacity: 1; }
}

/* ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ */
.title-screen {
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
  background: #222;
}

#startButton {
  font-size: 2rem;
  padding: 10px 20px;
  cursor: pointer;
}

document.getElementById("loginButton").addEventListener("click", async () => {
  console.log("ğŸ® ãƒ­ã‚°ã‚¤ãƒ³ãƒœã‚¿ãƒ³ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚Œã¾ã—ãŸ");

  const nameInput = document.getElementById("playerNameInput");
  const enteredName = nameInput.value.trim();
  if (!enteredName) {
    alert("åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼");
    return;
  }

  // ãƒ­ãƒ¼ãƒ‰ç”»é¢ã‚’è¡¨ç¤º
  document.getElementById("loadingScreen").style.display = "flex";
  document.getElementById("loginScreen").style.display = "none";

  try {
    // ãƒ‡ãƒ¼ã‚¿å–å¾—
    const params = new URLSearchParams();
    params.append("mode", "player");
    params.append("name", enteredName);

    const resp = await fetch(GAS_URL, {
      method: "POST",
      headers: { "Content-Type": "application/x-www-form-urlencoded" },
      body: params
    });
    if (!resp.ok) throw new Error("ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼");

    const data = await resp.json();
    if (!data.success) throw new Error(data.error || "ä¸æ˜ãªã‚¨ãƒ©ãƒ¼");

    // å–å¾—ã—ãŸãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’ã‚»ãƒƒãƒˆ
    playerData.name  = data.name;
    playerData.level = parseInt(data.level, 10);
    playerData.exp   = parseInt(data.exp, 10);
    playerData.g     = parseInt(data.g, 10);
    playerData.hp    = parseInt(data.hp, 10) || 50;
    updatePlayerStatusUI();
    console.log("âœ… ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‡ãƒ¼ã‚¿å–å¾—æˆåŠŸ:", playerData);

    // ã‚¯ã‚¤ã‚º & ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
    await loadQuizData();
    await loadMonsterData();

    // 1.5ç§’ã®é…å»¶ã‚’å…¥ã‚Œã¦æ¼”å‡º
    setTimeout(() => {
      document.getElementById("loadingScreen").style.display = "none";
      document.getElementById("titleScreen").style.display = "flex";
    }, 1500);

  } catch (err) {
    console.error("â›” ãƒ­ã‚°ã‚¤ãƒ³ã‚¨ãƒ©ãƒ¼:", err);
    alert("ãƒ­ã‚°ã‚¤ãƒ³ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚\n" + err.message);
    document.getElementById("loginScreen").style.display = "block";
    document.getElementById("loadingScreen").style.display = "none";
  }
});



/*******************************************************
 * ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢
 *******************************************************/
#titleScreen {
  position: relative;
  z-index: 9999; /* å¤§ãã‚ã®å€¤ */
  display: none;  /* ãƒ­ã‚°ã‚¤ãƒ³å¾Œã«è¡¨ç¤º */
  flex-direction: column;
  justify-content: center;
  align-items: center;
  width: 100%;
  height: 100%;
  background-color: #000;
}
#startButton {
  font-size: 24px;
  padding: 10px 20px;
  border: 2px solid #fff;
  background-color: #444;
  color: #fff;
  border-radius: 5px;
  cursor: pointer;
}

/*******************************************************
 * ã‚²ãƒ¼ãƒ ç”»é¢å…¨ä½“
 *******************************************************/
#gameContainer {
  display: none;  /* ã‚²ãƒ¼ãƒ é–‹å§‹å¾Œã«è¡¨ç¤º */
  width: 100%;
  height: 100%;
  position: relative;
}

/*******************************************************
 * ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º
 *******************************************************/
#status {
  padding: 10px;
  text-align: center;
  font-size: 18px;
  background-color: #111;
}

/*******************************************************
 * ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ç”»é¢ï¼ˆã‚¿ã‚¤ãƒ«ãƒãƒƒãƒ—è¡¨ç¤ºç”¨ï¼‰
 *******************************************************/
#gameArea {
  position: relative;
  width: 100%;
  height: calc(100% - 50px); /* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤ºåˆ†ã‚’é™¤ãé«˜ã• */
  /* èƒŒæ™¯ã¯ drawMap() ã§ã‚¿ã‚¤ãƒ«ãŒæç”»ã•ã‚Œã‚‹ãŸã‚ã€ã“ã“ã§ã¯ã‚·ãƒ³ãƒ—ãƒ«ãªèƒŒæ™¯è‰²ã‚’è¨­å®š */
  background-color: #333;
  overflow: hidden;
}

/* ãƒãƒƒãƒ—æç”»ç”¨ã‚³ãƒ³ãƒ†ãƒŠï¼ˆdrawMap() ã§åˆ©ç”¨ï¼‰ */
#mapContainer {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
}

/*******************************************************
 * ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚­ãƒ£ãƒ©
 *******************************************************/
#player {
  position: absolute;
  width: 30px;
  height: auto;
  z-index: 10;
}

/*******************************************************
 * D-Padï¼ˆã‚¹ãƒãƒ›æ“ä½œç”¨ï¼‰
 *******************************************************/
#dpad {
  position: fixed;
  z-index: 10; /* ã‚ã‚‹ç¨‹åº¦ä½ã‚ */
  position: fixed;
  bottom: 70px;
  right: 50px;
  width: 150px;
  height: 150px;
  display: grid;
  grid-template-areas:
    ".    up    ."
    "left center right"
    ".    down  .";
  gap: 8px;
  justify-content: center;
  align-items: center;
}
.dpad-button {
  width: 50px;
  height: 50px;
  font-size: 20px;
  font-weight: bold;
  text-align: center;
  background-color: #222;
  color: #fff;
  border: 2px solid #fff;
  border-radius: 8px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  user-select: none;
}
.dpad-button:hover {
  background-color: #444;
}
.up    { grid-area: up; }
.down  { grid-area: down; }
.left  { grid-area: left; }
.right { grid-area: right; }
.center {
  grid-area: center;
  background: transparent;
  border: none;
  pointer-events: none;
}

/*******************************************************
 * æˆ¦é—˜ï¼ˆï¼ã‚¯ã‚¤ã‚ºï¼‰ç”»é¢
 *******************************************************/
#battle-screen {
  display: none;
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: #000;
  z-index: 100;
  padding: 10px;
  text-align: center;
}
#top-text-box {
  border: 2px solid #fff;
  padding: 8px;
  margin-bottom: 10px;
  min-height: 40px;
  font-size: 16px;
}
#enemy-container {
  display: flex;
  justify-content: center;
  gap: 5px;
  margin-bottom: 10px;
}
.monster {
  width: 50px;
  height: 50px;
  object-fit: contain;
}
#quiz-image {
  display: none;
  width: 300px;
  height: 300px;
  margin: 10px auto;
}
#hp-container {
  display: flex;
  justify-content: center;
  font-size: 18px;
  margin-top: 20px;
}
.choice-button {
  display: block;
  margin: 5px auto;
  padding: 8px;
  width: 150px;
  font-size: 16px;
  cursor: pointer;
  border: none;
  border-radius: 4px;
  background-color: #555;
  color: #fff;
}
.choice-button:disabled {
  opacity: 0.5;
  cursor: default;
}

/*******************************************************
 * å††æ‹¡å¤§æ¼”å‡ºç”¨ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤
 *******************************************************/
#transition-overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 200;
  display: none;
  pointer-events: none;
}
#transition-circle {
  position: absolute;
  width: 200vmax;
  height: 200vmax;
  background-color: #000;
  border-radius: 50%;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%) scale(0);
  transition: transform 0.8s ease-out;
}
#transition-circle.active {
  transform: translate(-50%, -50%) scale(1);
}

/*******************************************************
 * ã‚·ã‚§ã‚¤ã‚¯ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
 *******************************************************/
@keyframes shake {
  0%   { transform: translate(0, 0); }
  20%  { transform: translate(-10px, 0); }
  40%  { transform: translate(10px, 0); }
  60%  { transform: translate(-10px, 0); }
  80%  { transform: translate(10px, 0); }
  100% { transform: translate(0, 0); }
}
.shake {
  animation: shake 0.5s;
}


/*******************************************************
 * ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–èª¿æ•´
 *******************************************************/
@media (max-width: 600px) {
  #status { font-size: 16px; padding: 10px; }
  #top-text-box { font-size: 14px; padding: 5px; }
  .choice-button { width: 120px; font-size: 14px; }
  #player { width: 25px; }
  #dpad { width: 120px; height: 120px; gap: 5px; }
}

@media (min-width: 768px) {
  #battle-screen { font-size: 20px; }
  #top-text-box { font-size: 18px; }
  .choice-button { width: 200px; font-size: 18px; }
  .monster { width: 80px; height: 80px; }
  #hp-container { font-size: 22px; }
}
